---
- name: Checking installed version of node.js
  shell: /usr/bin/test `node -v` = v{{ node_version }} && echo True
  register: node
  ignore_errors: yes

- name: Checking installed version of NPM
  shell: /usr/bin/test `npm -v` = {{ npm_version }} && echo True
  register: npm
  ignore_errors: yes

- name: Fetching node.js source
  action: get_url url=http://nodejs.org/dist/v{{ node_version }}/{{ node_tarball }} dest=/tmp/
  when: node|failed

- name: Unpack node.js tarball
  shell: /bin/tar xvfz {{ node_tarball }} chdir=/tmp/
  when: node|failed

- name: Take Ownership of Node Folder
  shell: /bin/chown -hR deploy:deploy  /tmp/{{ node_prefix }}
  sudo: yes
  when: node|failed

- name: Configure
  shell: chdir=/tmp/{{ node_prefix }} ./configure
  sudo: yes
  when: node|failed

- name: Make
  shell: chdir=/tmp/{{ node_prefix }} /usr/bin/make
  sudo: yes
  when: node|failed

- name: Make install
  shell: /usr/bin/make install chdir=/tmp/{{ node_prefix }}/
  sudo: yes
  when: node|failed

- name: Update npm
  shell: npm install npm@{{ npm_version }} -g
  sudo: yes
  when: npm|failed

- name: Clear npm config
  shell: npm config set ca ""
  sudo: yes
  when: npm|failed

- name: Clear npm config
  shell: npm config set ca ""
  when: npm|failed

- name: Clear npm cache
  shell: npm cache clear
  sudo: yes
  when: npm|failed

- name: Clear npm cache
  shell: npm cache clear
  when: npm|failed

- name: Install Grunt CLI
  npm: name=grunt-cli global=yes state=present
  sudo: yes

- name: Install Bower
  npm: name=bower global=yes state=present
  sudo: yes